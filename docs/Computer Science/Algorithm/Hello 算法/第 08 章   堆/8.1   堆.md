# 8.1 Â  å †
å †ï¼ˆheapï¼‰æ˜¯ä¸€ç§æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å®Œå…¨äºŒå‰æ ‘ï¼Œä¸»è¦å¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œå¦‚å›¾ æ‰€ç¤ºã€‚

- å°é¡¶å †ï¼ˆmin heapï¼‰ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼Â â‰¤Â å…¶å­èŠ‚ç‚¹çš„å€¼ã€‚
- å¤§é¡¶å †ï¼ˆmax heapï¼‰ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼Â â‰¥Â å…¶å­èŠ‚ç‚¹çš„å€¼ã€‚

![](images/Pasted%20image%2020240611111332.png)

å †ä½œä¸ºå®Œå…¨äºŒå‰æ ‘çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ã€‚

- æœ€åº•å±‚èŠ‚ç‚¹é å·¦å¡«å……ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹éƒ½è¢«å¡«æ»¡ã€‚
- æˆ‘ä»¬å°†äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ç§°ä¸ºâ€œå †é¡¶â€ï¼Œå°†åº•å±‚æœ€é å³çš„èŠ‚ç‚¹ç§°ä¸ºâ€œå †åº•â€ã€‚
- å¯¹äºå¤§é¡¶å †ï¼ˆå°é¡¶å †ï¼‰ï¼Œå †é¡¶å…ƒç´ ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰çš„å€¼æ˜¯æœ€å¤§ï¼ˆæœ€å°ï¼‰çš„ã€‚

## 8.1.1 Â  å †çš„å¸¸ç”¨æ“ä½œ
**å †é€šå¸¸ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¤§é¡¶å †ç›¸å½“äºå…ƒç´ æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºå‡ºé˜Ÿçš„ä¼˜å…ˆé˜Ÿåˆ—**ã€‚

## 8.1.2 Â  å †çš„å®ç°
ä¸‹æ–‡å®ç°çš„æ˜¯å¤§é¡¶å †ã€‚

### 1. Â  å †çš„å­˜å‚¨ä¸è¡¨ç¤º
å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘,**ç”¨æ•°ç»„æ¥å­˜å‚¨å †**

å½“ä½¿ç”¨æ•°ç»„è¡¨ç¤ºäºŒå‰æ ‘æ—¶ï¼Œå…ƒç´ ä»£è¡¨èŠ‚ç‚¹å€¼ï¼Œç´¢å¼•ä»£è¡¨èŠ‚ç‚¹åœ¨äºŒå‰æ ‘ä¸­çš„ä½ç½®ã€‚**èŠ‚ç‚¹æŒ‡é’ˆé€šè¿‡ç´¢å¼•æ˜ å°„å…¬å¼æ¥å®ç°**ã€‚

ç»™å®šç´¢å¼•Â ğ‘–Â ï¼Œå…¶å·¦å­èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºÂ 2ğ‘–+1Â ï¼Œå³å­èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºÂ 2ğ‘–+2Â ï¼Œçˆ¶èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºÂ (ğ‘–âˆ’1)/2ï¼ˆå‘ä¸‹æ•´é™¤ï¼‰ã€‚å½“ç´¢å¼•è¶Šç•Œæ—¶ï¼Œè¡¨ç¤ºç©ºèŠ‚ç‚¹æˆ–èŠ‚ç‚¹ä¸å­˜åœ¨ã€‚


![](images/Pasted%20image%2020240611112053.png)

```c
/* è·å–å·¦å­èŠ‚ç‚¹çš„ç´¢å¼• */
int left(MaxHeap *maxHeap, int i) {
    return 2 * i + 1;
}

/* è·å–å³å­èŠ‚ç‚¹çš„ç´¢å¼• */
int right(MaxHeap *maxHeap, int i) {
    return 2 * i + 2;
}

/* è·å–çˆ¶èŠ‚ç‚¹çš„ç´¢å¼• */
int parent(MaxHeap *maxHeap, int i) {
    return (i - 1) / 2; // å‘ä¸‹å–æ•´
}
```

### 2. Â  è®¿é—®å †é¡¶å…ƒç´ 
é¦–ä¸ªå…ƒç´ 
```c
/* è®¿é—®å †é¡¶å…ƒç´  */
int peek(MaxHeap *maxHeap) {
    return maxHeap->data[0];
}
```

### 3. Â  å…ƒç´ å…¥å †
æ¯”è¾ƒå †èŠ‚ç‚¹çš„valå¤§å°ï¼Œä»¥æ‰¾åˆ°ç›¸åº”ä½ç½®:å †åŒ–â€”â€”**ä¿®å¤ä»æ’å…¥èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„å„ä¸ªèŠ‚ç‚¹**

è€ƒè™‘ä»å…¥å †èŠ‚ç‚¹å¼€å§‹ï¼Œ**ä»åº•è‡³é¡¶æ‰§è¡Œå †åŒ–**
```c
/* å…ƒç´ å…¥å † */
void push(MaxHeap *maxHeap, int val) {
    // é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸åº”è¯¥æ·»åŠ è¿™ä¹ˆå¤šèŠ‚ç‚¹
    if (maxHeap->size == MAX_SIZE) {
        printf("heap is full!");
        return;
    }
    // æ·»åŠ èŠ‚ç‚¹
    maxHeap->data[maxHeap->size] = val;
    maxHeap->size++;

    // ä»åº•è‡³é¡¶å †åŒ–
    siftUp(maxHeap, maxHeap->size - 1);
}

/* ä»èŠ‚ç‚¹ i å¼€å§‹ï¼Œä»åº•è‡³é¡¶å †åŒ– */
void siftUp(MaxHeap *maxHeap, int i) {
    while (true) {
        // è·å–èŠ‚ç‚¹ i çš„çˆ¶èŠ‚ç‚¹
        int p = parent(maxHeap, i);
        // å½“â€œè¶Šè¿‡æ ¹èŠ‚ç‚¹â€æˆ–â€œèŠ‚ç‚¹æ— é¡»ä¿®å¤â€æ—¶ï¼Œç»“æŸå †åŒ–
        if (p < 0 || maxHeap->data[i] <= maxHeap->data[p]) {
            break;
        }
        // äº¤æ¢ä¸¤èŠ‚ç‚¹
        swap(maxHeap, i, p);
        // å¾ªç¯å‘ä¸Šå †åŒ–
        i = p;
    }
}
```

### 4. Â  å †é¡¶å…ƒç´ å‡ºå †
1. äº¤æ¢å †é¡¶ä¸å †åº•å…ƒç´ 
2. åˆ é™¤äº¤æ¢åçš„å †åº•å…ƒç´ 
3. ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä»é¡¶è‡³åº•å †åŒ–

```c
/* å…ƒç´ å‡ºå † */
int pop(MaxHeap *maxHeap) {
    // åˆ¤ç©ºå¤„ç†
    if (isEmpty(maxHeap)) {
        printf("heap is empty!");
        return INT_MAX;
    }
    // äº¤æ¢æ ¹èŠ‚ç‚¹ä¸æœ€å³å¶èŠ‚ç‚¹ï¼ˆäº¤æ¢é¦–å…ƒç´ ä¸å°¾å…ƒç´ ï¼‰
    swap(maxHeap, 0, size(maxHeap) - 1);
    // åˆ é™¤èŠ‚ç‚¹
    int val = maxHeap->data[maxHeap->size - 1];
    maxHeap->size--;
    // ä»é¡¶è‡³åº•å †åŒ–
    siftDown(maxHeap, 0);

    // è¿”å›å †é¡¶å…ƒç´ 
    return val;
}

/* ä»èŠ‚ç‚¹ i å¼€å§‹ï¼Œä»é¡¶è‡³åº•å †åŒ– */
void siftDown(MaxHeap *maxHeap, int i) {
    while (true) {
        // åˆ¤æ–­èŠ‚ç‚¹ i, l, r ä¸­å€¼æœ€å¤§çš„èŠ‚ç‚¹ï¼Œè®°ä¸º max
        int l = left(maxHeap, i);
        int r = right(maxHeap, i);
        int max = i;
        if (l < size(maxHeap) && maxHeap->data[l] > maxHeap->data[max]) {
            max = l;
        }
        if (r < size(maxHeap) && maxHeap->data[r] > maxHeap->data[max]) {
            max = r;
        }
        // è‹¥èŠ‚ç‚¹ i æœ€å¤§æˆ–ç´¢å¼• l, r è¶Šç•Œï¼Œåˆ™æ— é¡»ç»§ç»­å †åŒ–ï¼Œè·³å‡º
        if (max == i) {
            break;
        }
        // äº¤æ¢ä¸¤èŠ‚ç‚¹
        swap(maxHeap, i, max);
        // å¾ªç¯å‘ä¸‹å †åŒ–
        i = max;
    }
}
```



